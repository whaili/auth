# ========================================
# Bearer Token Service V2 - 生产环境配置
# ========================================
# 使用说明：
#   1. 复制此文件为 .env: cp .env.production .env
#   2. 修改下面的配置项
#   3. 执行部署: docker-compose --profile production up -d
# ========================================

# ========================================
# 服务基础配置
# ========================================

# 服务版本（用于镜像标签）
VERSION=2.0.0

# 服务端口（容器内固定 8080）
PORT=8080

# Nginx 端口
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# ========================================
# MongoDB 配置（外部副本集）
# ========================================

# MongoDB 副本集连接字符串（必填）
# 格式: mongodb://用户名:密码@主节点:端口,从节点1:端口,从节点2:端口/数据库名?replicaSet=副本集名&authSource=admin
#
# 示例（1主2备）:
# MONGO_URI=mongodb://bearer_token_wr:YOUR_PASSWORD@10.70.65.39:27019,10.70.65.40:27019,10.70.65.41:27019/bearer_token_service?replicaSet=rs0&authSource=admin
#
# 说明：
#   - bearer_token_wr: 数据库用户名
#   - YOUR_PASSWORD: 数据库密码
#   - 10.70.65.39:27019: 主节点地址
#   - 10.70.65.40:27019,10.70.65.41:27019: 从节点地址
#   - bearer_token_service: 数据库名称
#   - rs0: 副本集名称
#   - authSource=admin: 认证数据库
MONGO_URI=mongodb://bearer_token_wr:YOUR_PASSWORD@host1:27019,host2:27019,host3:27019/bearer_token_service?replicaSet=rs0&authSource=admin

# ========================================
# 账户查询配置 (AccountFetcher)
# ========================================

# 模式选择: local | external
# - local: 从本地 MongoDB 查询账户（适合独立部署）
# - external: 从外部 API 查询账户（推荐生产环境）
ACCOUNT_FETCHER_MODE=external

# 外部账户 API 配置（MODE=external 时必填）
# 七牛云账户服务 API 地址
EXTERNAL_ACCOUNT_API_URL=https://account-service.qiniu.com

# 外部账户 API Token（需要向账户服务团队申请）
EXTERNAL_ACCOUNT_API_TOKEN=YOUR_API_TOKEN_HERE

# ========================================
# 七牛 UID 映射配置 (QiniuUIDMapper)
# ========================================

# 模式选择: simple | database
# - simple: UID 直接映射为 "qiniu_{uid}"（性能高，推荐）
# - database: UID 查询 MongoDB 获取 account_id（灵活，支持账户管理）
QINIU_UID_MAPPER_MODE=simple

# 自动创建账户（仅当 MODE=database 时有效）
# - true: 首次访问自动创建账户（适合开发/测试）
# - false: 账户必须预先存在（推荐生产环境）
QINIU_UID_AUTO_CREATE=false

# ========================================
# HMAC 签名配置
# ========================================

# 时间戳容忍度（防重放攻击）
# 格式: 数字 + 单位 (s=秒, m=分钟, h=小时)
# 生产建议: 5m-10m
HMAC_TIMESTAMP_TOLERANCE=10m

# ========================================
# 索引创建控制
# ========================================

# 跳过索引创建（生产环境必须设置为 true）
# 生产环境应该由 init-db.sh 统一初始化索引，避免多实例并发创建索引
SKIP_INDEX_CREATION=true

# ========================================
# 配置检查清单
# ========================================
#
# 部署前请确认：
# ✅ MONGO_URI 已正确配置（包含所有副本集节点）
# ✅ EXTERNAL_ACCOUNT_API_URL 和 EXTERNAL_ACCOUNT_API_TOKEN 已配置
# ✅ 数据库索引已通过 init-db.sh 创建
# ✅ SKIP_INDEX_CREATION=true 已设置
# ✅ Nginx SSL 证书已配置（如需 HTTPS）
# ✅ 防火墙规则已配置（开放 80/443 端口）
#
