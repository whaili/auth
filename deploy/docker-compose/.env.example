# ========================================
# 环境变量配置模板
# ========================================
# 复制此文件为 .env 并修改配置
# cp .env.example .env

# ========================================
# 基础配置
# ========================================

# 服务版本（用于镜像标签）
VERSION=latest

# 服务端口（容器内固定 8080，此处配置宿主机映射端口）
HOST_PORT=8080
PORT=8080

# Nginx 端口（生产环境推荐使用 Nginx）
NGINX_HTTP_PORT=80
NGINX_HTTPS_PORT=443

# ========================================
# MongoDB 配置
# ========================================

# MongoDB Root 凭据（生产环境务必修改！）
MONGO_ROOT_USERNAME=admin
MONGO_ROOT_PASSWORD=changeme_in_production

# MongoDB 连接字符串（由 docker-compose 自动生成，无需修改）
# MONGO_URI=mongodb://admin:changeme@mongodb:27017

# ========================================
# 账户查询配置 (AccountFetcher)
# ========================================

# 模式选择: local | external
# - local: 从本地 MongoDB 查询账户（适合开发/独立部署）
# - external: 从外部 API 查询账户（适合生产环境）
ACCOUNT_FETCHER_MODE=local

# 外部账户 API 配置（仅当 MODE=external 时需要）
EXTERNAL_ACCOUNT_API_URL=https://account-service.qiniu.com
EXTERNAL_ACCOUNT_API_TOKEN=your_api_token_here

# ========================================
# 七牛 UID 映射配置 (QiniuUIDMapper)
# ========================================

# 模式选择: simple | database
# - simple: UID 直接映射为 "qiniu_{uid}"（性能高，推荐）
# - database: UID 查询 MongoDB 获取 account_id（灵活，支持账户管理）
QINIU_UID_MAPPER_MODE=simple

# 自动创建账户（仅当 MODE=database 时有效）
# - true: 首次访问自动创建账户
# - false: 账户必须预先存在
QINIU_UID_AUTO_CREATE=false

# ========================================
# HMAC 签名配置
# ========================================

# 时间戳容忍度（防重放攻击）
# 格式: 数字 + 单位 (s=秒, m=分钟, h=小时)
# 生产建议: 5m-10m
HMAC_TIMESTAMP_TOLERANCE=15m

# ========================================
# Redis 缓存配置（可选）
# ========================================

# 是否启用 Redis 缓存（默认 false）
REDIS_ENABLED=true

# Redis 地址
REDIS_ADDR=localhost:6379

# Redis 密码（可选，留空表示无密码）
REDIS_PASSWORD=

# Redis 数据库编号（0-15）
REDIS_DB=0

# Token 缓存过期时间（保守策略：5 分钟）
CACHE_TOKEN_TTL=5m

# ========================================
# Qconf 配置（用于 RPC 获取用户信息，推荐）
# ========================================
# 优先级：qconfapi RPC > MySQL
# 用于 /api/v2/validateu 端点获取用户详细信息

# 是否启用 qconfapi（设置为 true 优先使用 RPC，false 则使用 MySQL）
QCONF_ENABLED=true

# qconf 认证信息
# 生产环境:
QCONF_ACCESS_KEY=<YOUR_PRODUCTION_QCONF_ACCESS_KEY>
QCONF_SECRET_KEY=<YOUR_PRODUCTION_QCONF_SECRET_KEY>
QCONF_MASTER_HOSTS=http://10.34.35.42:8510,http://10.34.35.43:8510

# 测试环境（取消注释使用）:
# QCONF_ACCESS_KEY=-lnWyW53aRF1AYUj5D2oBBub377cTMYawZdOT25z
# QCONF_SECRET_KEY=FOXDmvIMttefUbUO8RWFIJ8JJdbPwvQGwoqZQL3O
# QCONF_MASTER_HOSTS=http://kodo-dev.confg.jfcs-k8s-qa2.qiniu.io

# Memcache 主机列表（可选，如果有）
QCONF_MC_HOSTS=

# 本地缓存配置
QCONF_LC_EXPIRES_MS=300000      # 本地缓存过期时间（毫秒）：5分钟
QCONF_LC_DURATION_MS=60000      # 本地缓存刷新间隔（毫秒）：1分钟
QCONF_LC_CHAN_BUFSIZE=1000      # 异步消息队列缓冲区大小
QCONF_MC_RW_TIMEOUT_MS=1000     # Memcache 读写超时（毫秒）

# ========================================
# 可观测性配置
# ========================================

# 日志级别: debug, info, warn, error
LOG_LEVEL=info

# 日志格式: json, text
# - json: 生产环境推荐，便于 ELK/Loki 采集
# - text: 开发环境推荐，便于阅读
LOG_FORMAT=text

# 日志文件路径（可选）
# - 留空: 仅输出到 stdout
# - 设置路径: 同时输出到 stdout 和文件
# 示例: /app/logs/service.log
LOG_FILE=

# ========================================
# 生产环境配置示例
# ========================================

# 取消下面的注释并修改值以启用生产配置

# # MongoDB（使用强密码）
# MONGO_ROOT_USERNAME=prod_admin
# MONGO_ROOT_PASSWORD=SecurePassword_12345!@#

# # 外部账户系统
# ACCOUNT_FETCHER_MODE=external
# EXTERNAL_ACCOUNT_API_URL=https://account-api.production.com
# EXTERNAL_ACCOUNT_API_TOKEN=prod_token_xyz123456

# # 数据库 UID 映射（不自动创建）
# QINIU_UID_MAPPER_MODE=database
# QINIU_UID_AUTO_CREATE=false

# # 更严格的时间戳容忍度
# HMAC_TIMESTAMP_TOLERANCE=10m

# # 使用不同的宿主机端口
# HOST_PORT=18080
