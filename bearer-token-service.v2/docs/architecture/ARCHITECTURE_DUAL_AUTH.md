# åŒè®¤è¯æ¶æ„è®¾è®¡

## ğŸ—ï¸ æ•´ä½“æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         å¤–éƒ¨è¯·æ±‚                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  HMAC ç­¾åè¯·æ±‚         â”‚      â”‚  QiniuStub è®¤è¯è¯·æ±‚        â”‚   â”‚
â”‚  â”‚                        â”‚      â”‚                            â”‚   â”‚
â”‚  â”‚  Authorization:        â”‚      â”‚  Authorization:            â”‚   â”‚
â”‚  â”‚  QINIU {AK}:{Sig}      â”‚      â”‚  QiniuStub uid=123&ut=1    â”‚   â”‚
â”‚  â”‚  X-Qiniu-Date: ...     â”‚      â”‚                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â–¼                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   UnifiedAuthMiddleware                         â”‚
â”‚            ï¼ˆç»Ÿä¸€è®¤è¯ä¸­é—´ä»¶ - è‡ªåŠ¨è¯†åˆ«è®¤è¯æ–¹å¼ï¼‰                     â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  HMAC è®¤è¯åˆ†æ”¯             â”‚   â”‚  QiniuStub è®¤è¯åˆ†æ”¯        â”‚  â”‚
â”‚  â”‚                            â”‚   â”‚                           â”‚  â”‚
â”‚  â”‚  1. è§£æ AccessKey         â”‚   â”‚  1. è§£æ URL å‚æ•°          â”‚  â”‚
â”‚  â”‚  2. æŸ¥è¯¢è´¦æˆ·ä¿¡æ¯            â”‚   â”‚  2. æå– UID              â”‚  â”‚
â”‚  â”‚  3. éªŒè¯ç­¾å                â”‚   â”‚  3. æ˜ å°„ UID â†’ account_id â”‚  â”‚
â”‚  â”‚  4. æ³¨å…¥ account_id        â”‚   â”‚  4. æ³¨å…¥ account_id       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                               â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Context["account_id"] â”‚
              â”‚  = "acc_xxx" or "qiniu_12345" â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Handler å±‚                                  â”‚
â”‚  ExtractAccountIDFromContext(ctx) â†’ è·å– account_id              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Service å±‚                                  â”‚
â”‚  CreateToken(ctx, accountID, req) â†’ åˆ›å»º Token                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Repository å±‚                                  â”‚
â”‚  MongoDB.InsertOne(token) â†’ ä¿å­˜åˆ°æ•°æ®åº“                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ è®¤è¯æµç¨‹è¯¦è§£

### HMAC ç­¾åè®¤è¯æµç¨‹

```
1. å®¢æˆ·ç«¯
   â”œâ”€ ç”Ÿæˆæ—¶é—´æˆ³: 2025-12-26T10:00:00Z
   â”œâ”€ æ„å»ºå¾…ç­¾åå­—ç¬¦ä¸²: POST\n/api/v2/tokens\n{timestamp}\n{body}
   â”œâ”€ è®¡ç®—ç­¾å: HMAC-SHA256(SecretKey, StringToSign)
   â””â”€ å‘é€è¯·æ±‚

2. æœåŠ¡ç«¯ (UnifiedAuthMiddleware)
   â”œâ”€ æ£€æµ‹åˆ° X-Qiniu-Date å¤´ â†’ HMAC è®¤è¯åˆ†æ”¯
   â”œâ”€ è§£æ Authorization: QINIU {AccessKey}:{Signature}
   â”œâ”€ é€šè¿‡ AccessKey æŸ¥è¯¢è´¦æˆ·ä¿¡æ¯ (AccountFetcher)
   â”‚   â””â”€ è¿”å›: {ID, Email, SecretKey, Status}
   â”œâ”€ éªŒè¯è´¦æˆ·çŠ¶æ€: Status == "active"
   â”œâ”€ éªŒè¯æ—¶é—´æˆ³: å…è®¸ Â±15 åˆ†é’Ÿè¯¯å·®
   â”œâ”€ é‡æ–°è®¡ç®—ç­¾åå¹¶å¯¹æ¯”
   â””â”€ æ³¨å…¥ Context: account_id = account.ID

3. Handler å±‚
   â””â”€ ä» Context æå– account_id â†’ è°ƒç”¨ Service
```

### QiniuStub è®¤è¯æµç¨‹

```
1. å®¢æˆ·ç«¯
   â””â”€ å‘é€è¯·æ±‚: Authorization: QiniuStub uid=1369077332&ut=1

2. æœåŠ¡ç«¯ (UnifiedAuthMiddleware)
   â”œâ”€ æ£€æµ‹åˆ° Authorization: QiniuStub â†’ QiniuStub è®¤è¯åˆ†æ”¯
   â”œâ”€ è§£æ URL å‚æ•°
   â”œâ”€ æå– UID â†’ QstubUserInfo{UID, Utype, Email...}
   â”œâ”€ è°ƒç”¨ QiniuUIDMapper.GetAccountIDByQiniuUID(uid)
   â”‚   â””â”€ ç®€å•æ¨¡å¼: ç›´æ¥è¿”å› "qiniu_{uid}"
   â”‚   â””â”€ æ•°æ®åº“æ¨¡å¼: æŸ¥è¯¢æˆ–åˆ›å»ºè´¦æˆ·æ˜ å°„
   â””â”€ æ³¨å…¥ Context: account_id = "qiniu_12345"

3. Handler å±‚
   â””â”€ ä» Context æå– account_id â†’ è°ƒç”¨ Service
```

---

## ğŸ§© æ ¸å¿ƒç»„ä»¶è¯´æ˜

### 1. UnifiedAuthMiddleware (ç»Ÿä¸€è®¤è¯ä¸­é—´ä»¶)

**èŒè´£**ï¼š
- è‡ªåŠ¨è¯†åˆ«è®¤è¯æ–¹å¼
- éªŒè¯è¯·æ±‚åˆæ³•æ€§
- å°† `account_id` æ³¨å…¥åˆ° Context

**å…³é”®æ–¹æ³•**ï¼š
```go
func (m *UnifiedAuthMiddleware) Authenticate(next http.HandlerFunc) http.HandlerFunc
```

**è®¤è¯è¯†åˆ«é€»è¾‘**ï¼š
```go
if timestampHeader != "" {
    // HMAC è®¤è¯ï¼ˆä¼˜å…ˆçº§æœ€é«˜ï¼‰
} else if strings.HasPrefix(authHeader, "QiniuStub ") {
    // QiniuStub è®¤è¯
} else {
    // ä¸æ”¯æŒçš„è®¤è¯æ–¹å¼
}
```

---

### 2. AccountFetcher (è´¦æˆ·æŸ¥è¯¢æ¥å£)

**èŒè´£**ï¼š
- æ ¹æ® AccessKey æŸ¥è¯¢è´¦æˆ·ä¿¡æ¯
- **è§£è€¦è®¾è®¡**ï¼šå¯æ›¿æ¢ä¸ºä»»ä½•å¤–éƒ¨è´¦æˆ·ç³»ç»Ÿ

**æ¥å£å®šä¹‰**ï¼š
```go
type AccountFetcher interface {
    GetAccountByAccessKey(ctx context.Context, accessKey string) (*AccountInfo, error)
}
```

**å®ç°ç¤ºä¾‹**ï¼š
```go
// å†…ç½® MongoDB å®ç°
type AccountFetcherImpl struct {
    repo *repository.MongoAccountRepository
}

// å¤–éƒ¨ API å®ç°
type ExternalAccountFetcher struct {
    apiClient *http.Client
}
```

---

### 3. QiniuUIDMapper (ä¸ƒç‰› UID æ˜ å°„å™¨)

**èŒè´£**ï¼š
- å°†ä¸ƒç‰› UID è½¬æ¢ä¸ºç³»ç»Ÿçš„ `account_id`
- æ”¯æŒè‡ªåŠ¨åˆ›å»ºè´¦æˆ·ï¼ˆå¯é€‰ï¼‰

**æ¥å£å®šä¹‰**ï¼š
```go
type QiniuUIDMapper interface {
    GetAccountIDByQiniuUID(ctx context.Context, qiniuUID uint32) (string, error)
}
```

**ä¸¤ç§å®ç°æ¨¡å¼**ï¼š

#### ç®€å•æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
```go
SimpleQiniuUIDMapper:
  UID: 12345 â†’ account_id: "qiniu_12345"
  UID: 67890 â†’ account_id: "qiniu_67890"

ä¼˜ç‚¹: æ— éœ€æ•°æ®åº“æŸ¥è¯¢ï¼Œå¿«é€Ÿé›†æˆ
ç¼ºç‚¹: æ— æ³•å…³è”åˆ°å·²æœ‰è´¦æˆ·ç³»ç»Ÿ
```

#### æ•°æ®åº“æ¨¡å¼ï¼ˆé«˜çº§ï¼‰
```go
DatabaseQiniuUIDMapper:
  1. æŸ¥è¯¢æ•°æ®åº“ï¼šSELECT account_id FROM accounts WHERE qiniu_uid = 12345
  2. å¦‚æœä¸å­˜åœ¨ä¸” autoCreate=trueï¼Œåˆ›å»ºæ–°è´¦æˆ·
  3. è¿”å› account_id

ä¼˜ç‚¹: å¯å…³è”åˆ°å·²æœ‰è´¦æˆ·ç³»ç»Ÿï¼Œæ”¯æŒè´¦æˆ·å…ƒæ•°æ®
ç¼ºç‚¹: éœ€è¦é¢å¤–æ•°æ®åº“æŸ¥è¯¢
```

---

## ğŸ” å®‰å…¨æ€§è®¾è®¡

### HMAC ç­¾åå®‰å…¨æªæ–½

1. **æ—¶é—´æˆ³éªŒè¯**ï¼šé˜²æ­¢é‡æ”¾æ”»å‡»ï¼ˆÂ±15 åˆ†é’Ÿçª—å£ï¼‰
2. **ç­¾åéªŒè¯**ï¼šé˜²æ­¢è¯·æ±‚ç¯¡æ”¹
3. **SecretKey ä¿æŠ¤**ï¼šä»…å­˜å‚¨åŠ å¯†åçš„ SecretKey
4. **è´¦æˆ·çŠ¶æ€æ£€æŸ¥**ï¼šç¦ç”¨è´¦æˆ·æ— æ³•é€šè¿‡è®¤è¯

### QiniuStub å®‰å…¨æªæ–½

1. **æ ¼å¼éªŒè¯**ï¼šéªŒè¯ URL å‚æ•°æ ¼å¼
2. **UID éªŒè¯**ï¼šç¡®ä¿ UID éç©ºä¸”æœ‰æ•ˆ
3. **è´¦æˆ·æ˜ å°„**ï¼šå¯é€‰çš„è´¦æˆ·éªŒè¯å’ŒçŠ¶æ€æ£€æŸ¥

**æ³¨æ„**ï¼šQiniuStub è®¤è¯é€‚åˆ**å†…éƒ¨æœåŠ¡**ï¼Œä¸å»ºè®®ç”¨äº**å…¬ç½‘æš´éœ²çš„ API**ã€‚

---

## ğŸ¯ æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ ç¬¬ä¸‰ç§è®¤è¯æ–¹å¼ï¼ˆä¾‹å¦‚ï¼šJWTï¼‰

1. åˆ›å»ºæ–°çš„è®¤è¯å¤„ç†å™¨ï¼š
```go
func (m *UnifiedAuthMiddleware) authenticateJWT(w, r, next) {
    token := parseJWT(r.Header.Get("Authorization"))
    accountID := extractAccountID(token)
    ctx := context.WithValue(r.Context(), "account_id", accountID)
    next.ServeHTTP(w, r.WithContext(ctx))
}
```

2. åœ¨ `Authenticate` æ–¹æ³•ä¸­æ·»åŠ æ–°åˆ†æ”¯ï¼š
```go
if strings.HasPrefix(authHeader, "Bearer ") {
    // åˆ¤æ–­æ˜¯ JWT è¿˜æ˜¯ QiniuStub
    if isJWT(authHeader) {
        m.authenticateJWT(w, r, next)
    } else {
        m.authenticateQstub(w, r, next)
    }
}
```

### å®Œå…¨è‡ªå®šä¹‰è®¤è¯

å¦‚æœæ‚¨éœ€è¦å®Œå…¨è‡ªå®šä¹‰çš„è®¤è¯æ–¹å¼ï¼Œåªéœ€å®ç°è‡ªå·±çš„ä¸­é—´ä»¶ï¼š

```go
func CustomAuthMiddleware(next http.HandlerFunc) http.HandlerFunc {
    return func(w http.ResponseWriter, r *http.Request) {
        // æ‚¨çš„è®¤è¯é€»è¾‘
        accountID := yourAuthLogic(r)

        // å…³é”®ï¼šæ³¨å…¥ account_id åˆ° Context
        ctx := context.WithValue(r.Context(), "account_id", accountID)
        next.ServeHTTP(w, r.WithContext(ctx))
    }
}
```

**æ ¸å¿ƒåŸåˆ™**ï¼šåªè¦åœ¨ Context ä¸­è®¾ç½® `account_id`ï¼ŒToken ç®¡ç†ç³»ç»Ÿå°±èƒ½æ­£å¸¸å·¥ä½œï¼

---

## ğŸ“Š æ€§èƒ½ä¼˜åŒ–

### HMAC è®¤è¯æ€§èƒ½

- **ç­¾åè®¡ç®—**ï¼š~0.1msï¼ˆHMAC-SHA256ï¼‰
- **è´¦æˆ·æŸ¥è¯¢**ï¼š~5msï¼ˆMongoDB ç´¢å¼•æŸ¥è¯¢ï¼‰
- **æ€»è€—æ—¶**ï¼š~5-10ms

**ä¼˜åŒ–å»ºè®®**ï¼š
- ç¼“å­˜è´¦æˆ·ä¿¡æ¯ï¼ˆRedisï¼‰ï¼šå‡å°‘æ•°æ®åº“æŸ¥è¯¢
- ä½¿ç”¨è¿æ¥æ± ï¼šæé«˜æ•°æ®åº“è®¿é—®æ€§èƒ½

### QiniuStub è®¤è¯æ€§èƒ½

- **URL å‚æ•°è§£æ**ï¼š~0.01ms
- **UID æ˜ å°„**ï¼ˆç®€å•æ¨¡å¼ï¼‰ï¼š~0.001msï¼ˆç›´æ¥å­—ç¬¦ä¸²æ‹¼æ¥ï¼‰
- **æ€»è€—æ—¶**ï¼š~0.01ms

**ä¼˜åŠ¿**ï¼šæ¯” HMAC å¿« 500 å€ï¼

---

## ğŸš€ éƒ¨ç½²å»ºè®®

### ç”Ÿäº§ç¯å¢ƒé…ç½®

```go
// ä½¿ç”¨æ•°æ®åº“æ˜ å°„æ¨¡å¼ï¼ˆæ”¯æŒè´¦æˆ·ç®¡ç†ï¼‰
qiniuUIDMapper := auth.NewDatabaseQiniuUIDMapper(accountRepo, false)  // ç¦ç”¨è‡ªåŠ¨åˆ›å»º

// æˆ–è€…ä½¿ç”¨æ··åˆæ¨¡å¼
type HybridMapper struct {
    simpleMapper   *SimpleQiniuUIDMapper
    databaseMapper *DatabaseQiniuUIDMapper
}

func (m *HybridMapper) GetAccountIDByQiniuUID(ctx, uid) (string, error) {
    // å…ˆå°è¯•æ•°æ®åº“æŸ¥è¯¢
    if accountID, err := m.databaseMapper.GetAccountIDByQiniuUID(ctx, uid); err == nil {
        return accountID, nil
    }
    // å›é€€åˆ°ç®€å•æ˜ å°„
    return m.simpleMapper.GetAccountIDByQiniuUID(ctx, uid)
}
```

### ç›‘æ§æŒ‡æ ‡

å»ºè®®ç›‘æ§ä»¥ä¸‹æŒ‡æ ‡ï¼š
- è®¤è¯æˆåŠŸç‡ï¼ˆæŒ‰è®¤è¯æ–¹å¼åˆ†ç±»ï¼‰
- è®¤è¯è€—æ—¶ï¼ˆP50ã€P95ã€P99ï¼‰
- ç­¾åéªŒè¯å¤±è´¥æ¬¡æ•°
- è´¦æˆ·æŸ¥è¯¢å¤±è´¥æ¬¡æ•°

---

## âœ… æ€»ç»“

### æ¶æ„ä¼˜åŠ¿

1. **çµæ´»æ€§**ï¼šæ”¯æŒå¤šç§è®¤è¯æ–¹å¼ï¼Œæ˜“äºæ‰©å±•
2. **è§£è€¦æ€§**ï¼šè®¤è¯å±‚ä¸ä¸šåŠ¡å±‚å®Œå…¨è§£è€¦
3. **å…¼å®¹æ€§**ï¼šä¿ç•™åŸæœ‰ HMAC è®¤è¯ï¼Œæ— ç¼æ·»åŠ æ–°è®¤è¯æ–¹å¼
4. **æ€§èƒ½**ï¼šä¸¤ç§è®¤è¯æ–¹å¼éƒ½ç»è¿‡ä¼˜åŒ–ï¼Œæ€§èƒ½ä¼˜å¼‚

### å…³é”®è®¾è®¡åŸåˆ™

1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä»¶äº‹
2. **æ¥å£æŠ½è±¡**ï¼šä½¿ç”¨æ¥å£è§£è€¦ï¼Œæ˜“äºæ›¿æ¢å®ç°
3. **Context ä¼ é€’**ï¼šé€šè¿‡ Context ä¼ é€’ `account_id`ï¼Œä¿æŒç®€æ´
4. **è‡ªåŠ¨è¯†åˆ«**ï¼šæ— éœ€é…ç½®ï¼Œè‡ªåŠ¨è¯†åˆ«è®¤è¯æ–¹å¼
